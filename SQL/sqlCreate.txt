DROP TABLE IF EXISTS User CASCADE;
DROP TABLE IF EXISTS Questionnaire CASCADE;
DROP TABLE IF EXISTS Question CASCADE;
DROP TABLE IF EXISTS Answer CASCADE;
DROP TABLE IF EXISTS Result CASCADE;
DROP TABLE IF EXISTS ResultAnswer CASCADE;

CREATE TABLE User (
id SERIAL PRIMARY KEY,
email VARCHAR(50) NOT NULL UNIQUE,
firstName VARCHAR(30) NOT NULL,
lastName VARCHAR(30) NOT NULL,
company VARCHAR(30),
telephone VARCHAR(30),
dateCreation TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
status ENUM ('active', 'inactive') DEFAULT 'active',
type ENUM('Administrator', 'Trainee') DEFAULT 'Trainee'
);

CREATE TABLE Questionnaire (
id SERIAL PRIMARY KEY,
subject VARCHAR(50) NOT NULL UNIQUE,
status ENUM ('active', 'inactive')
);

CREATE TABLE Question (
id SERIAL PRIMARY KEY,
text VARCHAR(500) NOT NULL,
position INTEGER NOT NULL,
status ENUM ('active', 'inactive'),
questionnaire INTEGER NOT NULL REFERENCES Questionnaire(id)
);

CREATE TABLE Answer (
id SERIAL PRIMARY KEY,
text VARCHAR(100) NOT NULL,
position INTEGER NOT NULL,
correction BOOLEAN NOT NULL,
status ENUM ('active', 'inactive'),
question INTEGER  NOT NULL REFERENCES Question(id)
);

CREATE TABLE Result (
id SERIAL PRIMARY KEY,
score INTEGER NOT NULL,
dateCreation TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
trainee INTEGER NOT NULL REFERENCES User(id)  
);

CREATE TABLE ResultAnswer(
result INTEGER REFERENCES Result(id),
answer INTEGER REFERENCES Answer(id),
PRIMARY KEY(result, answer)
)
